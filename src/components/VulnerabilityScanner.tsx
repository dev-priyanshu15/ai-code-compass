
import React, { useState } from 'react';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { AlertTriangle, Shield, Package } from 'lucide-react';
import { useToast } from '@/components/ui/use-toast';

const VulnerabilityScanner = () => {
  const { toast } = useToast();
  const [scanning, setScanning] = useState(false);
  const [progress, setProgress] = useState(0);
  const [results, setResults] = useState<null | {
    vulnerabilities: number;
    scannedPackages: number;
    highSeverity: number;
    mediumSeverity: number;
    lowSeverity: number;
  }>(null);
  
  const startScan = () => {
    setScanning(true);
    setProgress(0);
    setResults(null);
    
    // Simulate scanning progress
    const interval = setInterval(() => {
      setProgress(prev => {
        if (prev >= 100) {
          clearInterval(interval);
          setScanning(false);
          
          // Simulate results
          const mockResults = {
            vulnerabilities: 7,
            scannedPackages: 124,
            highSeverity: 2,
            mediumSeverity: 3,
            lowSeverity: 2,
          };
          
          setResults(mockResults);
          
          toast({
            title: 'Scan Complete',
            description: `Found ${mockResults.vulnerabilities} vulnerabilities in ${mockResults.scannedPackages} packages`,
          });
          
          return 100;
        }
        return prev + 5;
      });
    }, 200);
  };
  
  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center">
          <Shield className="mr-2 h-5 w-5" />
          Dependency Vulnerability Scanner
        </CardTitle>
        <CardDescription>
          Scan your dependencies for known security vulnerabilities
        </CardDescription>
      </CardHeader>
      <CardContent>
        {scanning ? (
          <div className="space-y-2">
            <div className="flex justify-between text-sm">
              <span>Scanning dependencies...</span>
              <span>{progress}%</span>
            </div>
            <Progress value={progress} className="h-2" />
          </div>
        ) : results ? (
          <div className="space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <div className="bg-secondary p-3 rounded-lg text-center">
                <div className="text-2xl font-bold">{results.vulnerabilities}</div>
                <div className="text-xs text-muted-foreground">Vulnerabilities</div>
              </div>
              <div className="bg-secondary p-3 rounded-lg text-center">
                <div className="text-2xl font-bold">{results.scannedPackages}</div>
                <div className="text-xs text-muted-foreground">Packages Scanned</div>
              </div>
            </div>
            
            <div className="space-y-2">
              <div className="flex justify-between items-center">
                <div className="flex items-center">
                  <div className="w-3 h-3 rounded-full bg-red-500 mr-2"></div>
                  <span className="text-sm">High Severity</span>
                </div>
                <span className="font-bold">{results.highSeverity}</span>
              </div>
              <div className="flex justify-between items-center">
                <div className="flex items-center">
                  <div className="w-3 h-3 rounded-full bg-yellow-500 mr-2"></div>
                  <span className="text-sm">Medium Severity</span>
                </div>
                <span className="font-bold">{results.mediumSeverity}</span>
              </div>
              <div className="flex justify-between items-center">
                <div className="flex items-center">
                  <div className="w-3 h-3 rounded-full bg-blue-500 mr-2"></div>
                  <span className="text-sm">Low Severity</span>
                </div>
                <span className="font-bold">{results.lowSeverity}</span>
              </div>
            </div>
          </div>
        ) : (
          <div className="flex items-center justify-center py-6 text-center">
            <div>
              <Package className="h-12 w-12 text-muted-foreground mx-auto mb-4" />
              <p className="text-muted-foreground">
                No recent scans. Start a new scan to check for vulnerabilities.
              </p>
            </div>
          </div>
        )}
      </CardContent>
      <CardFooter>
        <Button 
          onClick={startScan} 
          disabled={scanning}
          className="w-full"
          variant={results ? "secondary" : "default"}
        >
          {scanning ? 'Scanning...' : results ? 'Scan Again' : 'Start Scan'}
        </Button>
      </CardFooter>
    </Card>
  );
};

export default VulnerabilityScanner;
